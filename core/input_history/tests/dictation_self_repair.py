from ..cursor_position_tracker import CursorPositionTracker, _CURSOR_MARKER
from ..input_history import InputHistoryManager
from ..input_history_typing import InputHistoryEvent

def get_filled_ihm():
    input_history = InputHistoryManager()
    input_history.insert_input_events(input_history.text_to_input_history_events("Insert ", "insert"))
    input_history.insert_input_events(input_history.text_to_input_history_events("a ", "a"))
    input_history.insert_input_events(input_history.text_to_input_history_events("new ", "new"))
    input_history.insert_input_events(input_history.text_to_input_history_events("sentence ", "sentence"))
    input_history.insert_input_events(input_history.text_to_input_history_events("or ", "or"))
    input_history.insert_input_events(input_history.text_to_input_history_events("insert ", "insert"))
    input_history.insert_input_events(input_history.text_to_input_history_events("a ", "a"))
    input_history.insert_input_events(input_history.text_to_input_history_events("new ", "new"))
    input_history.insert_input_events(input_history.text_to_input_history_events("paragraph", "paragraph"))
    return input_history

def get_filled_ihm_with_examples(examples):
    input_history = InputHistoryManager()
    for index, example in enumerate(examples):
        input_history.insert_input_events(input_history.text_to_input_history_events(example + " " if index < len(examples) - 1 else example, example))
    return input_history

input_history = get_filled_ihm()
print( "With a filled input history, testing self repair in dictation")
print( "    Repetition")
print( "        Inserting the last placed word 'paragraph'...")
print( "            Should result in a detected self repair", input_history.detect_self_repair(["paragraph"]) )
print( "        Inserting the last placed words 'new paragraph'...")
print( "            Should result in a detected self repair", input_history.detect_self_repair(["new", "paragraph"]) )
print( "        Inserting the last placed words 'a new paragraph'...")
print( "            Should result in a detected self repair", input_history.detect_self_repair(["a", "new", "paragraph"]) )
print( "        Inserting the words 'paragraph word'... ")
print( "            Should result in a detected self repair", input_history.detect_self_repair(["paragraph", "word"]) == True )
print( "        Inserting the words 'a new paragraph with a new word'... ") 
print( "            Should result in a detected self repair", input_history.detect_self_repair("a new paragraph with a new word".split()) == True )
print( "    Appending ( no context or too far back)" )
print( "        Inserting the word 'word'...")
print( "            Should not result in a detected self repair", input_history.detect_self_repair(["word"]) == False )
print( "        Inserting the words 'insert word'...")
print( "            Should not result in a detected self repair", input_history.detect_self_repair(["insert", "word"]) == False )
print( "    Deletion of word")
print( "        Inserting the words 'a word'...")
print( "            Should result in a detected self repair", input_history.detect_self_repair(["a", "word"]) == True )
print( "    Replacement of word")
print( "        Inserting the words 'a new word'...")
print( "            Should result in a detected self repair", input_history.detect_self_repair(["a", "new", "word"]) == True )
print( "    Insertion in between words")
print( "        Inserting the words 'a new word paragraph'... ")
print( "           Should result in a detected self repair", input_history.detect_self_repair(["a", "new", "word", "paragraph"]) == True )
print( "    Insertion and appending")
print( "        Inserting the words 'a new word paragraph insert'... ")
print( "           Should result in a detected self repair", input_history.detect_self_repair(["a", "new", "word", "paragraph", "insert"]) == True )

print( "With a input history filled with examples of wrong self repair")
print( "    Inserting 'forget what we want to say' after 'when we'")
ihm = get_filled_ihm_with_examples(["when", "we"])
print( "        Should not result in self repair", ihm.detect_self_repair(["forget", "what", "we", "want", "to", "say"]) == False)
print( "    Inserting 'that would give us' after 'that is a fact'")
ihm = get_filled_ihm_with_examples(["that", "is", "a", "fact"])
print( "        Should not result in self repair", ihm.detect_self_repair(["that", "would", "give", "us"]) == False)
print( "    Inserting 'is it a' after 'is it a problem'")
ihm = get_filled_ihm_with_examples(["is", "it", "a", "problem"])
print( "        Should not result in self repair", ihm.detect_self_repair(["is", "it", "a"]) == False)
print( "    Inserting 'this is the test' after 'this is a test'")
ihm = get_filled_ihm_with_examples(["this", "is", "a", "test"])
print( "        Should result in self repair", ihm.detect_self_repair(["this", "is", "the", "test"]) == True)
print( "    Inserting 'formulate a paragraph' after 'formulate a sentence'")
ihm = get_filled_ihm_with_examples(["formulate", "a", "sentence"])
print( "        Should result in self repair", ihm.detect_self_repair(["formulate", "a", "paragraph"]) == True)
print( "    Inserting 'do fixes all the time' after 'want to'")
ihm = get_filled_ihm_with_examples(["want", "to"])
print( "        Should not result in self repair", ihm.detect_self_repair(["do", "fixes", "all", "the", "time"]) == False)